# this program include the catch and write into db
# And this documents catch sh market data.
import urllib
import urllib2
import time
import re
import datetime
import MySQLdb




addressa = "http://sqt.gtimg.cn/utf8/q=sh000001,sh000002,sh000003,sh000004,sh000005,sh000006,sh000007,sh000008,sh000010,sh000011,sh000012,sh000013,sh000015,sh000016,sh000017,sh000018,sh000019,sh000020,sh000021,sh000022,sh000023,sh000025,sh000026,sh000027,sh000028,sh000029,sh000030,sh000031,sh000032,sh000033,sh000034,sh000035,sh000036,sh000037,sh000038,sh000039,sh000040,sh000041,sh000042,sh000043,sh000044,sh000045,sh000046,sh000047,sh000048,sh000049,sh000054,sh000055,sh000056,sh000057,sh000058,sh000059,sh000060,sh000061,sh000062,sh000063,sh000064,sh000065,sh000300,sh000901,sh000902,sh000903,sh000904,sh000905,sh000906,sh000907,sh000908,sh000909,sh000910,sh000911,sh000912,sh000913,sh000914,sh000915,sh000916,sh000917,sh000918,sh000919,sh000920,sh000921,sh000922,sh000923,sh000924,sh000925,sh000926,sh000927,sh000928,sh000929,sh000930,sh000931,sh000932,sh000933,sh000934,sh000935,sh000936,sh000937,sh000938,sh000939,sh000940,sh000941,sh000942,sh000943,sh000944,sh000945,sh000946,sh000947,sh000948,sh000949,sh000950,sh000951,sh000952,sh000953,sh000954,sh000955,sh000956,sh000957,sh000959,sh000960,sh110003,sh110004,sh110005,sh110006,sh110007,sh110008,sh110078,sh110598,sh580022,sh580024,sh580026,sh580027,sh600000,sh600004,sh600005,sh600006,sh600007,sh600008,sh600009,sh600010,sh600011,sh600012,sh600015,sh600016,sh600017,sh600018,sh600019,sh600020,sh600021,sh600022,sh600026,sh600027,sh600028,sh600029,sh600030,sh600031,sh600033,sh600035,sh600036,sh600037,sh600038,sh600039,sh600048,sh600050,sh600051,sh600052,sh600053,sh600054,sh600055,sh600056,sh600058,sh600059,sh600060,sh600061,sh600062,sh600063,sh600064,sh600066,sh600067,sh600068,sh600069,sh600070,sh600071,sh600072,sh600073,sh600074,sh600075,sh600076,sh600077,sh600078,sh600079,sh600080,sh600081,sh600082,sh600083,sh600084,sh600085,sh600086,sh600087,sh600088,sh600089,sh600090,sh600091,sh600093,sh600095,sh600096,sh600097,sh600098,sh600099,sh600100,sh600101,sh600102,sh600103,sh600104,sh600105,sh600106,sh600107,sh600108,sh600109,sh600110,sh600111,sh600112,sh600113,sh600114,sh600115,sh600116,sh600117,sh600118,sh600119,sh600120,sh600121,sh600122,sh600123,sh600125,sh600126,sh600127,sh600128,sh600129,sh600130,sh600131,sh600132,sh600133,sh600135,sh600136,sh600137,sh600138,sh600139,sh600141,sh600143,sh600145,sh600146,sh600148,sh600149,sh600150,sh600151,sh600152,sh600153,sh600155,sh600156,sh600157,sh600158,sh600159,sh600160,sh600161,sh600162,sh600163,sh600165,sh600166,sh600167,sh600168,sh600169,sh600170,sh600171,sh600172,sh600173,sh600175,sh600176,sh600177,sh600178,sh600179,sh600180,sh600182,sh600183,sh600184,sh600185,sh600186,sh600187,sh600188,sh600189,sh600190,sh600191,sh600192,sh600193,sh600195,sh600196,sh600197,sh600198,sh600199,sh600200,sh600201,sh600202,sh600203,sh600206,sh600207,sh600208,sh600209,sh600210,sh600211,sh600212,sh600213,sh600215,sh600216,sh600217,sh600218,sh600219,sh600220,sh600221,sh600222,sh600223,sh600225,sh600226,sh600227,sh600228,sh600229,sh600230,sh600231,sh600232,sh600233,sh600234,sh600235,sh600236,sh600237,sh600238,sh600239,sh600240,sh600241,sh600242,sh600243,sh600246,sh600247,sh600248,sh600249,sh600250,sh600251,sh600252,sh600253,sh600255,sh600256,sh600257,sh600258,sh600259,sh600260,sh600261,sh600262,sh600263,sh600265,sh600266,sh600267,sh600268,sh600269,sh600270,sh600271,sh600272,sh600273,sh600275,sh600276,sh600277,sh600278,sh600279,sh600280,sh600281,sh600282,sh600283,sh600284,sh600285,sh600287,sh600288,sh600289,sh600290,sh600291,sh600292,sh600293,sh600295,sh600297,sh600298,sh600299,sh600300,sh600301,sh600302,sh600303,sh600305,sh600306,sh600307,sh600308,sh600309,sh600310,sh600311,sh600312,sh600313,sh600315,sh600316,sh600317,sh600318,sh600319,sh600320,sh600321,sh600322,sh600323,sh600325,sh600326,sh600327,sh600328,sh600329,sh600330,sh600331,sh600332,sh600333,sh600335,sh600336,sh600337,sh600338,sh600339,sh600340,sh600343,sh600345,sh600346,sh600348,sh600350,sh600351,sh600352,sh600353,sh600354,sh600355,sh600356,sh600358,sh600359,sh600360,sh600361,sh600362,sh600363,sh600365,sh600366,sh600367,sh600368,sh600369,sh600370,sh600371,sh600373,sh600375,sh600376,sh600377,sh600378,sh600379,sh600380,sh600381,sh600382,sh600383,sh600385,sh600386,sh600387,sh600388,sh600389,sh600390,sh600391,sh600392,sh600393,sh600395,sh600396,sh600397,sh600398,sh600399,sh600400,sh600403,sh600405,sh600406,sh600408,sh600409,sh600410,sh600415,sh600416,sh600418,sh600419,sh600420,sh600421,sh600422,sh600423,sh600425,sh600426,sh600428,sh600429,sh600432,sh600433,sh600435,sh600436,sh600438,sh600439,sh600444,sh600446,sh600448,sh600449,sh600452,sh600455,sh600456,sh600458,sh600459,sh600460,sh600461,sh600462,sh600463,sh600466,sh600467,sh600468,sh600469,sh600470,sh600475,sh600476,sh600477,sh600478,sh600479,sh600480,sh600481,sh600482,sh600483,sh600485,sh600486,sh600487,sh600488,sh600489,sh600490,sh600491,sh600493,sh600495,sh600496,sh600497,sh600498,sh600499,sh600500,sh600501,sh600502,sh600503,sh600505,sh600506,sh600507,sh600508,sh600509,sh600510,sh600511,sh600512,sh600513,sh600515,sh600516,sh600517,sh600518,sh600519,sh600520,sh600521,sh600522,sh600523,sh600525,sh600526,sh600527,sh600528,sh600529,sh600530,sh600531,sh600532,sh600533,sh600535,sh600536,sh600537,sh600538,sh600539,sh600540,sh600543,sh600545,sh600546,sh600547,sh600548,sh600549,sh600550,sh600551,sh600552,sh600553,sh600555,sh600557,sh600558,sh600559,sh600560,sh600561,sh600562,sh600563,sh600565,sh600566,sh600567,sh600568,sh600569,sh600570,sh600571"


addressb= "http://sqt.gtimg.cn/utf8/q=sh600753,sh600754,sh600755,sh600756,sh600757,sh600758,sh600759,sh600760,sh600761,sh600763,sh600764,sh600765,sh600766,sh600767,sh600768,sh600769,sh600770,sh600771,sh600773,sh600774,sh600775,sh600776,sh600777,sh600778,sh600779,sh600780,sh600781,sh600782,sh600783,sh600784,sh600785,sh600787,sh600789,sh600790,sh600791,sh600792,sh600793,sh600794,sh600795,sh600796,sh600797,sh600798,sh600800,sh600801,sh600802,sh600803,sh600804,sh600805,sh600806,sh600807,sh600808,sh600809,sh600810,sh600811,sh600812,sh600814,sh600815,sh600816,sh600817,sh600818,sh600819,sh600820,sh600821,sh600822,sh600823,sh600824,sh600825,sh600826,sh600827,sh600828,sh600829,sh600830,sh600831,sh600832,sh600833,sh600834,sh600835,sh600836,sh600837,sh600838,sh600839,sh600841,sh600843,sh600844,sh600845,sh600846,sh600847,sh600848,sh600850,sh600851,sh600853,sh600854,sh600855,sh600856,sh600857,sh600858,sh600859,sh600860,sh600861,sh600862,sh600863,sh600864,sh600865,sh600866,sh600867,sh600868,sh600869,sh600871,sh600872,sh600873,sh600874,sh600875,sh600876,sh600877,sh600879,sh600880,sh600881,sh600882,sh600883,sh600884,sh600885,sh600886,sh600887,sh600888,sh600889,sh600890,sh600891,sh600892,sh600893,sh600894,sh600895,sh600896,sh600897,sh600898,sh600900,sh600960,sh600961,sh600962,sh600963,sh600965,sh600966,sh600967,sh600969,sh600970,sh600971,sh600973,sh600975,sh600976,sh600978,sh600979,sh600980,sh600981,sh600982,sh600983,sh600984,sh600985,sh600986,sh600987,sh600988,sh600990,sh600991,sh600992,sh600993,sh600995,sh600997,sh600999,sh601001,sh601002,sh601003,sh601005,sh601006,sh601007,sh601008,sh601009,sh601088,sh601099,sh601106,sh601107,sh601111,sh601117,sh601139,sh601166,sh601168,sh601169,sh601179,sh601186,sh601268,sh601299,sh601318,sh601328,sh601333,sh601390,sh601398,sh601588,sh601600,sh601601,sh601607,sh601618,sh601628,sh601666,sh601668,sh601678,sh601688,sh601699,sh601727,sh601766,sh601788,sh601801,sh601808,sh601857,sh601866,sh601872,sh601877,sh601888,sh601898,sh601899,sh601918,sh601919,sh601939,sh601958,sh601988,sh601989,sh601991,sh601998,sh601999,sh000958,sh601188,sh601518"


def catchh(address,strt):
   conn=MySQLdb.connect(host='127.0.0.1',
                         user='root',
                         passwd='',
                         db='gp',
                         port=3306)


   cur = conn.cursor()
   url = (address)
   d=urllib2.urlopen(url)
   data = d.read()
   #print data
   data = re.split('[;]', data)
   k = len(data)
   for i in range(0,k-1):
     data1 = re.split('[~]', data[i])
     #print gpcode
     try:
         f1 =data1[0].find('_')
         f2 =data1[0].find('=')
         r1= data1[0][f1+1:f2]
         r2= data1[3]
         r3= data1[30]
         #print data1[0]
         sql = "INSERT INTO "+r1+ " VALUES(\'" + r2 + "','" + r3 + "')"
         #print sql
         try:

             cur.execute(sql)
             conn.commit()

         except MySQLdb.Error,e:
             #print "Mysql Error %d: %s" % (e.args[0], e.args[1])
             pass
     except:
         print data1[0]
         print "Error"

   print time.time()-strt
   cur.close()
   conn.close()

def catch():
  strt= time.time()
  catchh(addressa,strt)
  catchh(addressb,strt)


if __name__ == "__main__":
  catch()
